<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>tshare - Terminal Output</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/tokyo-night-dark.min.css" id="highlight-theme">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/shell.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .terminal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background-color: var(--code-bg);
      border-bottom: 1px solid var(--border-color);
      font-family: 'Fira Code', monospace;
    }
    
    .terminal-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      overflow-x: auto;
    }
    
    .user-host {
      color: var(--accent-color);
      font-weight: 500;
    }
    
    .working-dir {
      color: var(--success-color);
    }
    
    .command {
      color: var(--text-color);
    }
    
    .theme-selector {
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      cursor: pointer;
    }
    
    #output {
      flex-grow: 1;
      margin: 0;
      padding: 1.5rem;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-x: auto;
      border-radius: 0;
      border: none;
      line-height: 1.5;
      tab-size: 4;
    }
    
    .timestamp {
      text-align: right;
      padding: 0.5rem 1rem;
      color: var(--text-muted);
      font-size: 0.8rem;
      border-top: 1px solid var(--border-color);
    }
    
    #loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    
    .loader {
      width: 2.5rem;
      height: 2.5rem;
      border: 3px solid var(--text-muted);
      border-bottom-color: var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="loading">
    <div class="loader"></div>
  </div>
  
  <div id="error" style="display: none;"></div>
  
  <div id="content" style="display: none;">
    <div class="terminal-header">
      <div class="terminal-info">
        <span class="user-host" id="user-host">user@host</span>
        <span class="working-dir" id="working-dir">~/path</span>
        <span class="command" id="command">$ command</span>
      </div>
      <select id="theme-selector" class="theme-selector">
        <option value="atom-one-dark">Atom One Dark</option>
        <option value="atom-one-light">Atom One Light</option>
        <option value="github-dark">GitHub Dark</option>
        <option value="github">GitHub Light</option>
        <option value="monokai">Monokai</option>
        <option value="dracula">Dracula</option>
        <option value="nord">Nord</option>
        <option value="tokyo-night-dark">Tokyo Night</option>
        <option value="vs2015">VS 2015</option>
      </select>
    </div>
    <pre><code id="output"></code></pre>
    <div class="timestamp" id="timestamp"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const pasteId = window.location.pathname.substring(1);
      
      if (!pasteId) {
        showError('No paste ID provided');
        return;
      }
      
      fetch(`/api/paste/${pasteId}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Paste not found');
          }
          return response.json();
        })
        .then(data => {
          document.getElementById('user-host').textContent = data.hostname || 'user@host';
          document.getElementById('working-dir').textContent = data.workingDir || '~';
          document.getElementById('command').textContent = `$ ${data.command || 'unknown command'}`;
          
          const outputEl = document.getElementById('output');
          outputEl.textContent = data.content;
          outputEl.className = data.syntax || 'bash';
          
          const date = new Date(data.timestamp);
          document.getElementById('timestamp').textContent = `Created: ${date.toLocaleString()}`;
          
          hljs.highlightElement(outputEl);
          
          document.getElementById('loading').style.display = 'none';
          document.getElementById('content').style.display = 'block';
          
          document.title = `tshare: ${data.command || 'Shared Terminal Output'}`;
        })
        .catch(error => {
          showError(error.message);
        });
      
      document.getElementById('theme-selector').addEventListener('change', function(e) {
        const theme = e.target.value;
        document.getElementById('highlight-theme').href = `https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/${theme}.min.css`;
      });
    });
    
    function showError(message) {
      document.getElementById('loading').style.display = 'none';
      const errorEl = document.getElementById('error');
      errorEl.textContent = message || 'An error occurred';
      errorEl.style.display = 'block';
    }
  </script>
</body>
</html>
